function chess(e){var t,i,a,o=0,s=STATE_LOADING;this.initContainer=function(){s_oCanvas=document.getElementById("canvas"),s_oStage=new createjs.Stage(s_oCanvas),!1===(s_bMobile=isMobile())?s_oStage.enableMouseOver(20):createjs.Touch.enable(s_oStage,!0),s_iPrevTime=(new Date).getTime(),createjs.Ticker.addEventListener("tick",this._update),createjs.Ticker.framerate=FPS,navigator.userAgent.match(/Windows Phone/i),s_oSpriteLibrary=new CSpriteLibrary,i=new CPreloader,isIOS()?setTimeout(function(){sizeHandler()},200):sizeHandler()},this.preloaderReady=function(){this._loadImages(),t=!0},this._loadImages=function(){s_oSpriteLibrary.init(this._onImagesLoaded,this._onAllImagesLoaded,this),s_oSpriteLibrary.addSprite("bg_game","./sprites/bg_game.jpg"),s_oSpriteLibrary.addSprite("piece_lit","./sprites/piece_lit.png"),s_oSpriteLibrary.addSprite("highlight","./sprites/highlight.png"),s_oSpriteLibrary.addSprite("highlight_last_move","./sprites/highlight_last_move.png"),s_oSpriteLibrary.addSprite("highlight_landing","./sprites/highlight_landing.png"),s_oSpriteLibrary.addSprite("highlight_capture","./sprites/highlight_capture.png"),s_oSpriteLibrary.addSprite("board_frame","./sprites/board_frame.png"),s_oSpriteLibrary.addSprite("board_frame_1","./sprites/board_frame.png"),s_oSpriteLibrary.addSprite("board_occlusion","./sprites/board_occlusion.png"),s_oSpriteLibrary.addSprite("board_pattern","./sprites/board_pattern.png"),s_oSpriteLibrary.addSprite("board_pattern_1","./sprites/board_pattern.png"),s_oSpriteLibrary.addSprite("board_focus_shape","./sprites/board_focus_shape.png"),KING,PAWN,WHITE,BLACK,s_oSpriteLibrary.addSprite("shader_king_b","./sprites/shader_king_b.png"),s_oSpriteLibrary.addSprite("shader_king_w","./sprites/shader_king_w.png"),s_oSpriteLibrary.addSprite("shader_pawn","./sprites/shader_pawn.png"),s_oSpriteLibrary.addSprite("shader_pawn_positive","./sprites/shader_pawn_positive.png"),s_oSpriteLibrary.loadSprites()},this._onImagesLoaded=function(){o++,i.refreshLoader(Math.floor(o/0*100))},this._onRemovePreloader=function(){},this._onAllImagesLoaded=function(){},this.onAllPreloaderImagesLoaded=function(){this._loadImages()},this.gotoGame=function(e,t,i){s_iGameType=e,s_oGame=new CGameSingle(n,t,i),s=STATE_GAME},this.stopUpdate=function(){},this.startUpdate=function(){},this._update=function(e){if(!1!==t){var i=(new Date).getTime();s_iCntTime+=s_iTimeElaps=i-s_iPrevTime,s_iCntFps++,s_iPrevTime=i,1e3<=s_iCntTime&&(s_iCurFps=s_iCntFps,s_iCntTime-=1e3,s_iCntFps=0),s===STATE_GAME&&s_oGame.update(),s_oStage.update(e)}},s_oMain=this;var n=a;ENABLE_CHECK_ORIENTATION=!1,ENABLE_FULLSCREEN=!1,a=navigator.language.split("-")[0],window.ai=e,this.initContainer()}function CGameBase(e,t){this._bStartGame,this._iCurPlayer,this._iBlackTime,this._iWhiteTime,this._iNumBlack,this._iNumWhite,this._iDrawCounter,this._aCell,this._oInterface,this._oEndPanel=null,this._oParent,this._oThinking,this._oBoard,this._oCellActive=null,this._oPathDrawer,this._iPlayerState,this._oRules,this._oPiecesValue,this._aCaptureList,this._aAllAvailablePath,this._oPathChosen,this._oCellClicked,this._aMandatoryCells,this._bWhiteBotSide,this._iAnimationTime,this._iMinutes,this._iGameTypeIndex,SHOW_SCORE=!1,START_SCORE=5e3,SCORE_DECREASE_PER_SECOND=10,s_oGame=this,this._init(t)}function CGameSingle(e,t,i){this._bNoTime,CGameBase.call(this,e,i),this._startGame(t)}CGameBase.prototype._init=function(e){this._setRules(e),this._bWhiteBotSide=!0,this._iAnimationTime=ANIM_TIME_MOVE_TYPE[0],this._reset(),e=createBitmap(s_oSpriteLibrary.getSprite("bg_game")),s_oStage.addChild(e),this._oGeneralContainer=new createjs.Container,this._oGeneralContainer.x=CANVAS_WIDTH/2,this._oGeneralContainer.y=CANVAS_HEIGHT/2,s_oStage.addChild(this._oGeneralContainer),this._oBoardContainer=new createjs.Container,this._oGeneralContainer.addChild(this._oBoardContainer),this._oPiecesContainer=new createjs.Container,this._oGeneralContainer.addChild(this._oPiecesContainer),this._oInfoPanelContainer=new createjs.Container,this._oInfoPanelContainer.x=this._oGeneralContainer.x,this._oInfoPanelContainer.y=this._oGeneralContainer.y,s_oStage.addChild(this._oInfoPanelContainer),this._oThinking=new CThinking,this._oThinking.hide(),this._initBoard(),this._configureBoard(),new CMovesController(this._aCell,this._oRules),new CBoardStateController,this._checkLegalMoves()},CGameBase.prototype._reset=function(){this._bStartGame=!0,this._iCurPlayer=this._oRules.starting_player,this._iDrawCounter=this._iWhiteTime=this._iBlackTime=0,this._iPlayerState=PLAYER_STATE_WAIT,this._aCaptureList=[]},CGameBase.prototype._setRules=function(e){this._oRules=copyObjectByValue(e)},CGameBase.prototype.getRules=function(){return this._oRules},CGameBase.prototype._initBoard=function(){var e=this._oRules.starting_board;this._setPiecesValue(this._oRules),this._oBoard=new CBoard(0,0,this._oBoardContainer,e.length,this._oRules.origin_cell_color);var t=this._oBoard.getCellSize(),i=this._oBoard.getCellsPos(),a=this._oBoard.getScale();this._aCell=[];for(var o=0;o<e.length;o++){this._aCell[o]=[];for(var s=0;s<e[o].length;s++){var n=i[o][s];(n=new CCell(n.x,n.y,{row:o,col:s},this._oPiecesContainer,t)).addEventListener(ON_MOUSE_DOWN,this.onCellDown,this),n.addEventListener(ON_MOUSE_UP,this.onCellUp,this),n.addEventListener(ON_MOUSE_OVER,this.onCellOver,this),n.addEventListener(ON_MOUSE_OUT,this.onCellOut,this),this._aCell[o][s]=n}}this._oPiecesContainer.scale=a,this._oPathDrawer=new CPathDrawer(i,t,this._oPiecesContainer)},CGameBase.prototype._configureBoard=function(){for(var e=this._oRules.starting_board,t=0;t<this._aCell.length;t++)for(var i=0;i<this._aCell[t].length;i++){var a=e[t][i];null!==a&&(a=this._aCell[t][i].createPiece(a.color,a.type),ON_PIECE_START_MOVE,a.addEventListener(ON_PIECE_START_MOVE,this.onPieceStartMove,this),a.addEventListener(ON_PIECE_MOVE,this.onPieceMove,this),a.addEventListener(ON_PIECE_MOVED,this.onPieceMoved,this),a.addEventListener(ON_PIECE_COMPLETED_ALL_MOVES,this.onFinishMove,this))}this.countPawn()},CGameBase.prototype._cleanBoard=function(){for(var e=0;e<this._aCell.length;e++)for(var t=0;t<this._aCell[e].length;t++)this._aCell[e][t].setLastMove(!1),this._aCell[e][t].remove()},CGameBase.prototype.refreshGUI=function(){this.refreshSize(),this.refreshControllerObjects()},CGameBase.prototype.refreshSize=function(){var e=60,t=CANVAS_WIDTH-2*s_iOffsetX-e;if(e=CANVAS_HEIGHT-2*s_iOffsetY-e,s_bLandscape){if(this._oGeneralContainer&&this._oGeneralContainer.getBounds()){var i=0,a=450;1.6<s_iAspectRatio?a=740:1.6>=s_iAspectRatio&&(i=12),a=895+a,i=zoomInCamera(this._oGeneralContainer,t,e,a,895+i),e=0,1.6>=s_iAspectRatio&&(e=CANVAS_WIDTH/2-200-(a/2-350)*i),this._oGeneralContainer.x=CANVAS_WIDTH/2-e}}else this._oGeneralContainer&&this._oGeneralContainer.getBounds()&&(i=zoomInCamera(this._oGeneralContainer,t,e,895,1189),this._oGeneralContainer.x=CANVAS_WIDTH/2);this._oInfoPanelContainer.x=this._oGeneralContainer.x,this._oInfoPanelContainer.y=this._oGeneralContainer.y,this._oInfoPanelContainer.scaleX=this._oInfoPanelContainer.scaleY=i},CGameBase.prototype.rotateBoard=function(e){e=e?0:180,this._oBoardContainer.rotation=e,this._oPiecesContainer.rotation=e;for(var t=0;t<this._aCell.length;t++)for(var i=0;i<this._aCell[t].length;i++)this._aCell[t][i].rotatePiece(e)},CGameBase.prototype._checkEndGame=function(){if(0===this._iNumBlack)return this.gameOver(WHITE),!0;if(0===this._iNumWhite)return this.gameOver(BLACK),!0;if(this._iDrawCounter++,this._iDrawCounter===DRAW_COUNTER)return this.gameOver(DRAW),!0;var e=s_oBoardStateController.getOtherOpponent(this._iCurPlayer),t=s_oBoardStateController.copyBoard(this._aCell);return 0===s_oMovesController.getAllMovesInfoInBoard(e,t).length&&(t=WIN_BLACK_WHITE_NOMOVES,e===BLACK&&(t=WIN_WHITE_BLACK_NOMOVES),this.gameOver(t),!0)},CGameBase.prototype.gameOver=function(e){},CGameBase.prototype._disableAllClick=function(){for(var e=0;e<this._aCell.length;e++)for(var t=0;t<this._aCell[e].length;t++)this._aCell[e][t].setClickableArea(!1)},CGameBase.prototype.tryToSelect=function(e,t){if(0<this._aMandatoryCells.length)for(var i=0;i<this._aMandatoryCells.length;i++){var a=this._aMandatoryCells[i].logic_pos;e===a.row&&t===a.col&&(this._activeMandatoryCells(!1),this._selectPiece(e,t))}else this._aCell[e][t].getColor()===this._iCurPlayer&&this._selectPiece(e,t)},CGameBase.prototype._onBoardUp=function(){this._oCellClicked&&(this._oCellClicked.removeOverListeners(),this._oCellClicked=null)},CGameBase.prototype.onCellDown=function(e,t){if(this._oCellClicked=this._aCell[e][t],this._iPlayerState===PLAYER_STATE_SELECTED){var i=this._getPath(e,t);null!==i&&(this._iPlayerState=PLAYER_STATE_PATH_CHOSEN,this._disableAllHighlight(),this._highlightFromPath(i,!0))}},CGameBase.prototype.onCellOver=function(e,t){if(this._iPlayerState===PLAYER_STATE_SELECTED){var i=this._getPath(e,t);null!==i&&(this._iPlayerState=PLAYER_STATE_PATH_CHOSEN,this._disableAllHighlight(),this._highlightFromPath(i,!0))}},CGameBase.prototype.onCellOut=function(e,t){if(this._iPlayerState===PLAYER_STATE_PATH_CHOSEN){var i=this._oCellActive.getLogicPos();this._selectPiece(i.row,i.col)}},CGameBase.prototype.onCellUp=function(e,t){switch(this._oCellClicked&&(this._oCellClicked.removeOverListeners(),this._oCellClicked=null),this._iPlayerState){case PLAYER_STATE_WAIT:this.tryToSelect(e,t);break;case PLAYER_STATE_SELECTED:this._aCell[e][t].getColor()===this._iCurPlayer?(this._deselectPiece(),this.tryToSelect(e,t)):this._deselectPiece();break;case PLAYER_STATE_PATH_CHOSEN:this._aCell[e][t].isLanding()&&this._movePiece(e,t)}},CGameBase.prototype._selectPiece=function(e,t){this._oCellActive=this._aCell[e][t],this._oCellActive.setActive(!0),this._disableAllHighlight();var i=s_oBoardStateController.copyBoard(this._aCell);this._aAllAvailablePath=s_oMovesController.getMovesList(e,t,i),this._oPathDrawer.clear(),this._highlightAllPaths(),this._iPlayerState=PLAYER_STATE_SELECTED},CGameBase.prototype._getPath=function(e,t){for(var i=null,a=0;a<this._aAllAvailablePath.length;a++)if(this._aAllAvailablePath[a].terminal.row===e&&this._aAllAvailablePath[a].terminal.col===t){i=this._aAllAvailablePath[a];break}return i},CGameBase.prototype.onPieceStartMove=function(e){this._hideLastMove(),this._aCell[e.row][e.col].setLastMove(!0)},CGameBase.prototype.onPieceMove=function(e,t,i){t=s_oMovesController.getLine(t,e.dest);for(var a=0;a<t.length;a++){for(var o=copyObjectByValue(this._oPathChosen),s=0;s<=i;s++)o.jump_list.splice(0,1);o.src=e.dest;var n=s_oMovesController.getAllCellsFromAPath(o);o=!0;var r=t[a];for(s=0;s<n.length;s++)if(n[s].row===r.row&&n[s].col===r.col){o=!1,this._aCell[r.row][r.col].captureHighlight(!1);break}n=(s=500/t.length)*a,o&&this._aCell[r.row][r.col].unlitAll(s,n)}},CGameBase.prototype.onPieceMoved=function(e,t){if(e.capture){var i=e.capture.logic_pos,a=(i=this._aCell[i.row][i.col]).getType(),o=i.getColor();this._aCaptureList.push({type:a,color:o}),i.setCaptured(),this._iDrawCounter=0}this._oRules.pawn_can_continue_as_king&&(i=0===(a=e.dest).row&&t.getColor()===WHITE,a=a.row===this._aCell.length-1&&t.getColor()===BLACK,(i||a)&&t.promote())},CGameBase.prototype.onFinishMove=function(e,t){if(t.getType()===PAWN){this._iDrawCounter=0;var i=0===e.row&&t.getColor()===WHITE,a=e.row===this._aCell.length-1&&t.getColor()===BLACK;(i||a)&&t.promote()}this._aCell[e.row][e.col].setLastMove(!0),this._aCell[e.row][e.col].setPiece(t),this._oPathDrawer.clear(),this.countPawn(),this.updateStats(),this._checkEndGame()||this.changeTurn()},CGameBase.prototype._checkLegalMoves=function(){window.Moves=CGameBase.prototype._checkLegalMoves.bind(this),this._aMandatoryCells=[];var e=s_oBoardStateController.copyBoard(this._aCell);this._aMandatoryCells=s_oMovesController.getMandatoryCells(this._iCurPlayer,e),this._activeMandatoryCells(!0)},CGameBase.prototype._activeMandatoryCells=function(e){for(var t=0;t<this._aMandatoryCells.length;t++){var i=this._aMandatoryCells[t].logic_pos;this._aCell[i.row][i.col].setActive(e)}},CGameBase.prototype._deselectPiece=function(){this._aAllAvailablePath=null,this._disableAllHighlight(),this._oCellActive.setActive(!1),this._oCellActive=null,this._activeMandatoryCells(!0),this._iPlayerState=PLAYER_STATE_WAIT},CGameBase.prototype.restartGame=function(){s_oGame._oEndPanel.unload(),s_oGame._oEndPanel=null,s_oGame._oCellActive=null,s_oGame._disableAllHighlight(),s_oGame._reset(),s_oGame._cleanBoard(),s_oGame._configureBoard(),s_oGame._oInterface.activePlayer(s_oGame._iCurPlayer),s_oGame._checkLegalMoves(),s_oGame._checkTurn(),s_oGame.updateStats(),s_oGame._bStartGame=!0},CGameBase.prototype.pauseGame=function(e){this._bStartGame=!e},CGameBase.prototype.getAnimTime=function(){return this._iAnimationTime},CGameBase.prototype.getCurPlayer=function(){return this._iCurPlayer},CGameBase.prototype._onExitHelp=function(){this._bStartGame=!0},CGameBase.prototype.getCapturedList=function(e){for(var t=[],i=0;i<this._aCaptureList.length;i++){var a=this._aCaptureList[i];a.color===e&&t.push(a)}return t},CGameBase.prototype._setPiecesValue=function(e){switch(this._oPiecesValue={},this._oPiecesValue[PAWN]=1,this._oPiecesValue[KING]=1.4,e.king_movement){case KING_MOVEMENT_FLY:this._oPiecesValue[KING]+=1.2;break;case KING_MOVEMENT_FLY_BLOCK:this._oPiecesValue[KING]+=.5}(e=e.capture_rule).king_protected&&(this._oPiecesValue[KING]+=.2),e.back&&(this._oPiecesValue[PAWN]+=.2)},CGameBase.prototype.getWinChance=function(){var e=[];e[WHITE]=0;for(var t=e[BLACK]=0;t<this._aCell.length;t++)for(var i=0;i<this._aCell[t].length;i++){var a=this._aCell[t][i];a.getType()&&(e[a.getColor()]+=this._oPiecesValue[a.getType()])}return(t=[])[WHITE]=e[WHITE]/(e[WHITE]+e[BLACK])*100,t[BLACK]=100-t[WHITE],t},CGameBase.prototype.updateStats=function(){var e=this.getCapturedList(WHITE),t=this.getCapturedList(BLACK),i=this.getWinChance()[WHITE].toFixed(1),a=(100-i).toFixed(1);this._oInterface.updateStats(e,t,i,a)},CGameBase.prototype.initTime=function(){this._iBlackTime=this._iWhiteTime=this._iMinutes,this._oInterface.refreshWhiteTime(this._iWhiteTime),this._oInterface.refreshBlackTime(this._iBlackTime)},CGameBase.prototype._increaseTime=function(){this._iCurPlayer===WHITE?(this._iWhiteTime+=s_iTimeElaps,this._oInterface.refreshWhiteTime(this._iWhiteTime),this._iWhiteScore-=SCORE_DECREASE_PER_SECOND*s_iTimeElaps/1e3,0>this._iWhiteScore&&(this._iWhiteScore=0)):(this._iBlackTime+=s_iTimeElaps,this._oInterface.refreshBlackTime(this._iBlackTime),this._iBlackScore-=SCORE_DECREASE_PER_SECOND*s_iTimeElaps/1e3,0>this._iBlackScore&&(this._iBlackScore=0))},CGameBase.prototype.refreshTime=function(){this._bNoTime?this._increaseTime():this._decreaseTime()},CGameBase.prototype.update=function(){this._bStartGame&&this.refreshTime()},CGameBase.prototype._hideLastMove=function(){for(var e=0;e<this._aCell.length;e++)for(var t=0;t<this._aCell[e].length;t++)this._aCell[e][t].setLastMove(!1)},CGameBase.prototype._highlightAllPaths=function(){for(var e=0;e<this._aAllAvailablePath.length;e++)this._highlightFromPath(this._aAllAvailablePath[e],!1);this._oPathDrawer.drawAllTrack(this._aAllAvailablePath)},CGameBase.prototype._highlightFromPath=function(e,t){for(var i=e.jump_list,a=0;a<i.length;a++){var o=i[a].capture;null!==o&&(o=o.logic_pos,this._aCell[o.row][o.col].captureHighlight(t))}i=e.terminal,this._aCell[i.row][i.col].setLanding(!0),this._oPathDrawer.showSinglePath(i)},CGameBase.prototype._disableAllHighlight=function(){this._oPathDrawer.hideAll();for(var e=0;e<this._aCell.length;e++)for(var t=0;t<this._aCell[e].length;t++)this._aCell[e][t].captureHighlight(!1),this._aCell[e][t].setLanding(!1)},CGameBase.prototype._checkMatrix=function(e){for(var t="",i=0;i<this._aCell.length;i++){for(var a=0;a<this._aCell[i].length;a++)t=0<=e[i][a]?t+" "+e[i][a]+" | ":t+(e[i][a]+" | ");t+="|| "+i+"\n"}},CGameBase.prototype.countPawn=function(){for(var e,t=this._iNumWhite=this._iNumBlack=0;t<this._aCell.length;t++)for(var i=0;i<this._aCell[t].length;i++)(e=this._aCell[t][i].getColor())===BLACK?this._iNumBlack++:e===WHITE&&this._iNumWhite++},CGameBase.prototype.getCells=function(){return this._aCell},CGameBase.prototype.getCurrentPlayer=function(){return this._iCurPlayer},CGameSingle.prototype=Object.create(CGameBase.prototype),CGameSingle.prototype._startGame=function(e){this._oInterface=new CInterfaceSingle(this._oInfoPanelContainer),this._oInterface.configureInfoPanel(!0),this._bNoTime=!1,0===parseInt(e)&&(this._bNoTime=!0,this._oInterface.showTime(!1)),this._iMinutes=6e4*e,this._iGameTypeIndex=MATCH_MINUTES_TYPE.indexOf(e),this._iAnimationTime=ANIM_TIME_MOVE_TYPE[this._iGameTypeIndex],this.initTime(),window.s_oInterface=s_oInterface,s_iGameType===MODE_HUMAN?s_oInterface.setPlayersInfo(TEXT_WHITE,TEXT_BLACK):s_oInterface.setPlayersInfo(TEXT_PLAYER,TEXT_CPU),this._oAI=window.ai,this._oAI.addEventListener(ON_END_AI_COMPUTATION,this._onEndAIComputation,this),this.updateStats(),this._checkTurn()},CGameSingle.prototype.refreshControllerObjects=function(){},CGameSingle.prototype._movePiece=function(e,t){this._iPlayerState=PLAYER_STATE_MOVING;var i=this._getPath(e,t);this._disableAllHighlight(),this._highlightFromPath(i,!0);for(var a=0;a<i.jump_list.length;a++){var o=i.jump_list[a],s=o.dest;o.pos=this._aCell[s.row][s.col].getPos()}this._oCellActive.move(i.jump_list,this._iAnimationTime),this._oPathChosen=i},CGameSingle.prototype._checkTurn=function(){this._iCurPlayer===WHITE?s_iGameType===MODE_COMPUTER&&this._oThinking.hide():s_iGameType===MODE_COMPUTER&&(this._oThinking.show(),this._playAI()),this._oInterface.activePlayer(this._iCurPlayer)},CGameSingle.prototype.changeTurn=function(){this._iCurPlayer=s_oBoardStateController.getOtherOpponent(this._iCurPlayer),this._checkTurn(),this._iPlayerState=PLAYER_STATE_WAIT,this._checkLegalMoves()},CGameSingle.prototype._playAI=function(e){e||(this._oThinking.show(),e=s_oBoardStateController.copyBoard(this._aCell),this._oAI.getMove(this._iCurPlayer,e))},CGameSingle.prototype._onEndAIComputation=function(e){s_oGame._oThinking.hide();var t=e.cell.logic_pos,i=e.path.terminal;s_oGame._activeMandatoryCells(!1),s_oGame._selectPiece(t.row,t.col),s_oGame._movePiece(i.row,i.col)},CGameSingle.prototype.unload=function(){this._bStartGame=!1,clearTimeout(this._iIDTimeoutAI),this._oInterface.unload(),null!==this._oEndPanel&&this._oEndPanel.unload(),createjs.Tween.removeAllTweens(),s_oStage.removeAllChildren()},CGameSingle.prototype.onExit=function(){s_oGame.unload()},CGameSingle.prototype.setEndPanel=function(e){this._oEndPanel=new CEndPanel(s_oSpriteLibrary.getSprite("msg_box")),this._oEndPanel.setRestartBut(s_oGame._onConfirmRematch,s_oGame),this._oEndPanel.setCheckBut(function(){s_oGame.checkBoard(e)},s_oGame),this._oEndPanel.setHomeBut(s_oGame.onExit,s_oGame),setTimeout(function(){s_oGame._oEndPanel.show(e,s_oGame._iBlackTime,s_oGame._iWhiteTime,s_oGame._iBlackScore,s_oGame._iWhiteScore,s_oGame._iGameTypeIndex)},1e3)},CGameSingle.prototype._onConfirmRematch=function(){this.restartGame(),this.initTime()},CGameSingle.prototype.checkBoard=function(){var e=new createjs.Shape;e.graphics.beginFill("rgba(0,0,0,0.01)").drawRect(0,0,CANVAS_WIDTH,CANVAS_HEIGHT),e.on("click",s_oGame.returnToEndPanel,s_oGame,!0,e),s_oStage.addChild(e),this._oEndPanel.hide()},CGameSingle.prototype.returnToEndPanel=function(e,t){s_oStage.removeChild(t),this._oEndPanel.reShow()},CGameSingle.prototype.restartGame=function(){CGameBase.prototype.restartGame()},CGameSingle.prototype._decreaseTime=function(){this._iCurPlayer===WHITE?(this._iWhiteTime-=s_iTimeElaps,this._iWhiteScore-=SCORE_DECREASE_PER_SECOND*s_iTimeElaps/1e3,0>this._iWhiteScore&&(this._iWhiteScore=0),0>this._iWhiteTime&&(this._iWhiteTime=0,this._bStartGame=!1,this.setEndPanel(TIME_OVER)),this._oInterface.refreshWhiteTime(this._iWhiteTime)):(this._iBlackTime-=s_iTimeElaps,this._iBlackScore-=SCORE_DECREASE_PER_SECOND*s_iTimeElaps/1e3,0>this._iBlackScore&&(this._iBlackScore=0),0>this._iBlackTime&&(clearTimeout(this._iAITimeoutID),this._iBlackTime=0,this._bStartGame=!1,this.setEndPanel(TIME_OVER)),this._oInterface.refreshBlackTime(this._iBlackTime))};